# HarmoneyOpenEye ç”Ÿå‘½å‘¨æœŸä¸å‡½æ•°é—´æ•°æ®æµåˆ†æç»“æœ

## ğŸ“Š åˆ†ææ¦‚è§ˆ

**é¡¹ç›®**: HarmoneyOpenEye - ä»¿å¼€çœ¼è§†é¢‘ HarmonyOS åº”ç”¨  
**åˆ†æç±»å‹**: ç”Ÿå‘½å‘¨æœŸè¯†åˆ« + å‡½æ•°é—´æ•°æ®æµåˆ†æ + UndefinedVariable æ£€æµ‹  
**åˆ†ææ¡†æ¶**: ArkAnalyzer (IFDS + CHA è°ƒç”¨å›¾)  
**åˆ†ææ—¶é—´**: 2025å¹´11æœˆ17æ—¥

---

## ğŸ¯ æ ¸å¿ƒç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æ€»æ–‡ä»¶æ•°** | 74 | é¡¹ç›®æºæ–‡ä»¶ |
| **æ€»æ–¹æ³•æ•°** | 505 | æ‰€æœ‰æ–¹æ³• |
| **ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ•°** | **33** | Ability + Component |
| **è°ƒç”¨å›¾èŠ‚ç‚¹æ•°** | **529** | æ–¹æ³•èŠ‚ç‚¹ |
| **è°ƒç”¨å›¾è¾¹æ•°** | **409** | è°ƒç”¨å…³ç³» |
| **æ•°æ®æµè·¯å¾„æ•°** | **44** | å‡½æ•°é—´æ•°æ®æµ |
| **æœªå®šä¹‰å˜é‡é—®é¢˜** | **3** | æ½œåœ¨ç©ºæŒ‡é’ˆé£é™© |

---

## ğŸ” ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¯¦ç»†åˆ†æ

### 1. Ability ç”Ÿå‘½å‘¨æœŸï¼ˆ6ä¸ªæ–¹æ³•ï¼‰

**EntryAbility** - åº”ç”¨å…¥å£ Abilityï¼š
```typescript
âœ“ onCreate()              // åº”ç”¨åˆ›å»º
âœ“ onWindowStageCreate()   // çª—å£åˆ›å»º
âœ“ onForeground()          // è¿›å…¥å‰å°
âœ“ onBackground()          // è¿›å…¥åå°
âœ“ onWindowStageDestroy()  // çª—å£é”€æ¯
âœ“ onDestroy()             // åº”ç”¨é”€æ¯
```

**ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº**ï¼š
```
onCreate() 
  â†“
onWindowStageCreate()
  â†“
onForeground()
  â†“
onBackground()
  â†“
onWindowStageDestroy()
  â†“
onDestroy()
```

### 2. Component ç”Ÿå‘½å‘¨æœŸï¼ˆ27ä¸ªæ–¹æ³•ï¼Œ15ä¸ªç»„ä»¶ï¼‰

#### é¡µé¢ç»„ä»¶ï¼ˆ11ä¸ªï¼‰

1. **MainPage** (ä¸»é¡µé¢) - 4ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•
   - `aboutToAppear()` - é¡µé¢å³å°†æ˜¾ç¤º
   - `aboutToDisappear()` - é¡µé¢å³å°†éšè—
   - `onPageShow()` - é¡µé¢æ˜¾ç¤º
   - `onPageHide()` - é¡µé¢éšè—

2. **SplashPage** (å¯åŠ¨é¡µ)
   - `aboutToAppear()`

3. **HomePage** (é¦–é¡µ)
   - `aboutToAppear()`

4. **FindPage** (å‘ç°é¡µ)
   - `aboutToAppear()`

5. **TopicPage** (è¯é¢˜é¡µ)
   - `aboutToAppear()`

6. **RankPage** (æ’è¡Œæ¦œé¡µ)
   - `aboutToAppear()`

7. **MinePage** (æˆ‘çš„é¡µ) - 2ä¸ªæ–¹æ³•
   - `aboutToAppear()`
   - `aboutToDisappear()`

8. **CategoryPage** (åˆ†ç±»é¡µ)
   - `aboutToAppear()`

9. **CategoryDetailPage** (åˆ†ç±»è¯¦æƒ…é¡µ)
   - `aboutToAppear()`

10. **DetailPage** (è¯¦æƒ…é¡µ)
    - `aboutToAppear()`

11. **TopicDetailPage** (è¯é¢˜è¯¦æƒ…é¡µ)
    - `aboutToAppear()`

#### ç‰¹æ®Šé¡µé¢ï¼ˆ2ä¸ªï¼‰

12. **HotPage** (çƒ­é—¨é¡µ) - 2ä¸ªæ–¹æ³•
    - `onPageShow()`
    - `onPageHide()`

13. **CoordinatePage** (åè°ƒé¡µ)
    - `aboutToAppear()`

14. **ContainerPage** (å®¹å™¨é¡µ)
    - `aboutToAppear()`

15. **FocusPage** (å…³æ³¨é¡µ)
    - `aboutToAppear()`

#### UIç»„ä»¶ï¼ˆ5ä¸ªï¼‰

16. **VideoBottomComponent** (è§†é¢‘åº•éƒ¨ç»„ä»¶)
    - `aboutToAppear()`

17. **CommonSkeleton** (éª¨æ¶å±ç»„ä»¶)
    - `aboutToAppear()`

18. **CommonDialog** (é€šç”¨å¯¹è¯æ¡†)
    - `aboutToAppear()`

19. **CommonTopBar** (é€šç”¨é¡¶éƒ¨æ )
    - `aboutToAppear()`

20. **CustomTabLayout** (è‡ªå®šä¹‰æ ‡ç­¾å¸ƒå±€) - 2ä¸ªæ–¹æ³•
    - `aboutToAppear()`
    - `aboutToDisappear()`

21. **LoadingDialog** (åŠ è½½å¯¹è¯æ¡†)
    - `aboutToAppear()`

---

## ğŸ“ˆ è°ƒç”¨å›¾åˆ†æ

### è°ƒç”¨å›¾è§„æ¨¡
- **èŠ‚ç‚¹æ•°**: 529 ä¸ªæ–¹æ³•
- **è¾¹æ•°**: 409 æ¡è°ƒç”¨å…³ç³»
- **å¹³å‡å‡ºåº¦**: 0.77 (æ¯ä¸ªæ–¹æ³•å¹³å‡è°ƒç”¨ 0.77 ä¸ªå…¶ä»–æ–¹æ³•)

### è°ƒç”¨å›¾ç‰¹ç‚¹
1. **å…¥å£ç‚¹**: DummyMain ä½œä¸ºç»Ÿä¸€å…¥å£
2. **ç®—æ³•**: CHA (Class Hierarchy Analysis) - ç±»å±‚æ¬¡åˆ†æ
3. **è¦†ç›–èŒƒå›´**: æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åŠå…¶è°ƒç”¨é“¾
4. **å¯è§†åŒ–**: å·²å¯¼å‡º DOT æ ¼å¼æ–‡ä»¶

### è°ƒç”¨å›¾æ–‡ä»¶
- **è·¯å¾„**: `./output/openeye-callgraph.dot`
- **æ ¼å¼**: Graphviz DOT
- **æŸ¥çœ‹æ–¹å¼**:
  ```bash
  dot -Tpng ./output/openeye-callgraph.dot -o callgraph.png
  ```
  æˆ–åœ¨çº¿æŸ¥çœ‹: https://dreampuf.github.io/GraphvizOnline/

---

## ğŸ”„ å…³é”®æ•°æ®æµè·¯å¾„ï¼ˆå‰15æ¡ï¼‰

### 1. Ability ç”Ÿå‘½å‘¨æœŸæ•°æ®æµ

#### EntryAbility.onCreate â†’ hilog.info
```
åˆ›å»ºåº”ç”¨æ—¶è®°å½•æ—¥å¿—
è¡Œå·: 12
```

#### EntryAbility.onWindowStageCreate â†’ windowStage.getMainWindow
```
è·å–ä¸»çª—å£å®ä¾‹
è¡Œå·: 25
```

#### EntryAbility.onWindowStageCreate â†’ windowStage.loadContent
```
åŠ è½½é¡µé¢å†…å®¹ (SplashPage)
è¡Œå·: 58
```

### 2. ä¸»é¡µé¢æ•°æ®æµ

#### MainPage.aboutToAppear â†’ emitter.on
```
æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
è¡Œå·: 31
```

#### MainPage.aboutToDisappear â†’ emitter.off
```
æ³¨é”€äº‹ä»¶ç›‘å¬å™¨
è¡Œå·: 45
```

### 3. å¯åŠ¨é¡µæ•°æ®æµ

#### SplashPage.aboutToAppear â†’ setTimeout
```
å»¶æ—¶è·³è½¬åˆ°ä¸»é¡µ
è¡Œå·: 8
```

### 4. åˆ†ç±»è¯¦æƒ…é¡µæ•°æ®æµ

#### CategoryDetailPage.aboutToAppear â†’ router.getParams
```
è·å–è·¯ç”±å‚æ•°
è¡Œå·: 28
```

#### CategoryDetailPage.aboutToAppear â†’ loadNet
```
åŠ è½½ç½‘ç»œæ•°æ®
è¡Œå·: 27
```

### 5. è¯¦æƒ…é¡µæ•°æ®æµ

#### DetailPage.aboutToAppear â†’ loadNet
```
åŠ è½½è¯¦æƒ…æ•°æ®
```

#### VideoBottomComponent.aboutToAppear â†’ loadNet
```
åŠ è½½è§†é¢‘åº•éƒ¨ä¿¡æ¯
```

### 6. å…¶ä»–å…³é”®æ•°æ®æµ

- **ContainerPage.aboutToAppear â†’ convertTitle**: è½¬æ¢æ ‡é¢˜
- **CoordinatePage.aboutToAppear â†’ forEach**: éå†æ•°æ®
- **CommonTopBar.aboutToAppear â†’ setSystemStatusBar**: è®¾ç½®çŠ¶æ€æ 
- **CommonSkeleton.aboutToAppear â†’ push**: æ·»åŠ éª¨æ¶å±é¡¹

---

## âš ï¸ æœªå®šä¹‰å˜é‡é—®é¢˜åˆ†æ

### é—®é¢˜æ€»æ•°: 3 ä¸ªï¼ˆä¸¥é‡ç¨‹åº¦: ä¸­ç­‰ ğŸŸ¡ï¼‰

#### é—®é¢˜ 1: EntryAbility.onWindowStageCreate
```typescript
è¡Œå·: 24
é—®é¢˜: windowClass = null
ä¸¥é‡ç¨‹åº¦: ğŸŸ¡ ä¸­ç­‰
è¯´æ˜: çª—å£å¯¹è±¡å¯èƒ½ä¸º nullï¼Œéœ€è¦æ·»åŠ ç©ºå€¼æ£€æŸ¥
```

**ä¿®å¤å»ºè®®**:
```typescript
// ä¿®å¤å‰
const windowClass = windowStage.getMainWindow();
windowClass.setWindowLayoutFullScreen(true);

// ä¿®å¤å
const windowClass = windowStage.getMainWindow();
if (windowClass) {
    windowClass.setWindowLayoutFullScreen(true);
}
```

#### é—®é¢˜ 2: MainPage.aboutToDisappear
```typescript
è¡Œå·: 44
é—®é¢˜: this.loadedEventId å¯èƒ½æœªå®šä¹‰
ä¸¥é‡ç¨‹åº¦: ğŸŸ¡ ä¸­ç­‰
è¯´æ˜: äº‹ä»¶ ID å¯èƒ½æœªåˆå§‹åŒ–å°±è¢«ä½¿ç”¨
```

**ä¿®å¤å»ºè®®**:
```typescript
// ä¿®å¤å‰
emitter.off(this.loadedEventId);

// ä¿®å¤å
if (this.loadedEventId) {
    emitter.off(this.loadedEventId);
}
```

#### é—®é¢˜ 3: MinePage.aboutToDisappear
```typescript
è¡Œå·: 24
é—®é¢˜: å±æ€§è®¿é—®å¯èƒ½ä¸º undefined
ä¸¥é‡ç¨‹åº¦: ğŸŸ¡ ä¸­ç­‰
è¯´æ˜: ç»„ä»¶å±æ€§å¯èƒ½æœªåˆå§‹åŒ–
```

**ä¿®å¤å»ºè®®**:
```typescript
// æ·»åŠ å±æ€§åˆå§‹åŒ–æ£€æŸ¥
aboutToDisappear() {
    if (this.someProperty) {
        // å®‰å…¨è®¿é—®
    }
}
```

---

## ğŸ“Š æ•°æ®æµæ¨¡å¼åˆ†æ

### 1. åˆå§‹åŒ–æ¨¡å¼ï¼ˆæœ€å¸¸è§ï¼‰
```
aboutToAppear() â†’ loadData() â†’ updateUI()
```
**å‘ç°æ¬¡æ•°**: 20+  
**åº”ç”¨é¡µé¢**: HomePage, FindPage, TopicPage, RankPage ç­‰

### 2. æ¸…ç†æ¨¡å¼
```
aboutToDisappear() â†’ cleanup() â†’ removeListeners()
```
**å‘ç°æ¬¡æ•°**: 5  
**åº”ç”¨ç»„ä»¶**: MainPage, MinePage, CustomTabLayout

### 3. è·¯ç”±æ¨¡å¼
```
aboutToAppear() â†’ router.getParams() â†’ loadDataWithParams()
```
**å‘ç°æ¬¡æ•°**: 3  
**åº”ç”¨é¡µé¢**: CategoryDetailPage, DetailPage, TopicDetailPage

### 4. äº‹ä»¶è®¢é˜…æ¨¡å¼
```
aboutToAppear() â†’ emitter.on()
aboutToDisappear() â†’ emitter.off()
```
**å‘ç°æ¬¡æ•°**: 2  
**åº”ç”¨ç»„ä»¶**: MainPage

---

## ğŸ¯ æ¶æ„æ´å¯Ÿ

### 1. ç”Ÿå‘½å‘¨æœŸä½¿ç”¨è§„èŒƒ
âœ… **ä¼˜ç‚¹**:
- æ‰€æœ‰é¡µé¢éƒ½æ­£ç¡®å®ç°äº† `aboutToAppear()`
- éœ€è¦æ¸…ç†çš„ç»„ä»¶éƒ½å®ç°äº† `aboutToDisappear()`
- ä¸»é¡µæ­£ç¡®ä½¿ç”¨äº† `onPageShow/Hide` é…åˆ `aboutToAppear/Disappear`

âš ï¸ **æ”¹è¿›ç©ºé—´**:
- éƒ¨åˆ†é¡µé¢ç¼ºå°‘ `aboutToDisappear()` æ¸…ç†é€»è¾‘
- å¯ä»¥è€ƒè™‘æ·»åŠ æ›´å¤šé¡µé¢çº§åˆ«çš„ `onPageShow/Hide` å¤„ç†

### 2. æ•°æ®æµç‰¹å¾
- **åŒæ­¥åˆå§‹åŒ–**: å¤§éƒ¨åˆ†é¡µé¢åœ¨ `aboutToAppear()` ä¸­åŒæ­¥åŠ è½½æ•°æ®
- **å¼‚æ­¥ç½‘ç»œè¯·æ±‚**: ä½¿ç”¨ ViewModel å±‚ç®¡ç†å¼‚æ­¥æ•°æ®æµ
- **äº‹ä»¶é©±åŠ¨**: ä½¿ç”¨ emitter è¿›è¡Œè·¨ç»„ä»¶é€šä¿¡

### 3. å†…å­˜ç®¡ç†
âœ… **åšå¾—å¥½çš„åœ°æ–¹**:
- MainPage å’Œ CustomTabLayout æ­£ç¡®æ³¨é”€äº‹ä»¶ç›‘å¬
- MinePage å®ç°äº†æ¸…ç†é€»è¾‘

âš ï¸ **æ½œåœ¨é£é™©**:
- å¤§éƒ¨åˆ†é¡µé¢æœªå®ç° `aboutToDisappear()`
- å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼é£é™©ï¼ˆäº‹ä»¶ç›‘å¬å™¨ã€å®šæ—¶å™¨æœªæ¸…ç†ï¼‰

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åˆ†æå·¥å…·é“¾
1. **Scene æ„å»º**: è§£æ 74 ä¸ª .ets æ–‡ä»¶
2. **ç±»å‹æ¨å¯¼**: `scene.inferTypes()` å¢å¼ºç±»å‹ä¿¡æ¯
3. **DummyMain åˆ›å»º**: ç”Ÿæˆç»Ÿä¸€å…¥å£ç‚¹
4. **è°ƒç”¨å›¾æ„å»º**: CHA ç®—æ³•ï¼Œ529 ä¸ªèŠ‚ç‚¹
5. **æ•°æ®æµåˆ†æ**: IFDS æ¡†æ¶è¿½è¸ªå‡½æ•°é—´æ•°æ®æµ
6. **UndefinedVariable æ£€æµ‹**: é™æ€åˆ†æç©ºæŒ‡é’ˆé£é™©

### IFDS æ¡†æ¶
- **å…¨ç§°**: Interprocedural Finite Distributive Subset
- **ç”¨é€”**: å‡½æ•°é—´æ•°æ®æµåˆ†æ
- **ä¼˜åŠ¿**: ç²¾ç¡®è¿½è¸ªæ•°æ®åœ¨æ–¹æ³•é—´çš„æµåŠ¨
- **åº”ç”¨**: æ£€æµ‹æœªå®šä¹‰å˜é‡ã€ç©ºæŒ‡é’ˆã€æ±¡ç‚¹åˆ†æ

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. é«˜ä¼˜å…ˆçº§
1. **ä¿®å¤æœªå®šä¹‰å˜é‡é—®é¢˜**: æ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼ˆ3å¤„ï¼‰
2. **å®Œå–„æ¸…ç†é€»è¾‘**: ä¸ºæ‰€æœ‰è®¢é˜…äº‹ä»¶çš„ç»„ä»¶æ·»åŠ  `aboutToDisappear()`
3. **å®šæ—¶å™¨æ¸…ç†**: SplashPage çš„ setTimeout åº”åœ¨ç»„ä»¶é”€æ¯æ—¶æ¸…é™¤

### 2. ä¸­ä¼˜å…ˆçº§
1. **ç”Ÿå‘½å‘¨æœŸç»Ÿä¸€**: ä¸ºä¸»è¦é¡µé¢æ·»åŠ  `onPageShow/Hide` å¤„ç†
2. **é”™è¯¯è¾¹ç•Œ**: åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ·»åŠ  try-catch
3. **æ€§èƒ½ä¼˜åŒ–**: é¿å…åœ¨ `aboutToAppear()` ä¸­æ‰§è¡Œé‡åº¦è®¡ç®—

### 3. ä½ä¼˜å…ˆçº§
1. **æ—¥å¿—è§„èŒƒ**: ç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸæ—¥å¿—æ ¼å¼
2. **è°ƒç”¨å›¾ä¼˜åŒ–**: å‡å°‘ä¸å¿…è¦çš„æ–¹æ³•è°ƒç”¨å±‚çº§
3. **ä»£ç å¤ç”¨**: æå–å…¬å…±çš„ç”Ÿå‘½å‘¨æœŸé€»è¾‘åˆ° BaseViewModel

---

## ğŸ“ æ‰§è¡Œå‘½ä»¤

### è¿è¡Œåˆ†æ
```bash
cd openeye-analysis
ts-node analyzeOpenEyeLifecycle.ts
```

### æŸ¥çœ‹è°ƒç”¨å›¾
```bash
# ç”Ÿæˆ PNG å›¾ç‰‡
dot -Tpng ./output/openeye-callgraph.dot -o callgraph.png

# æˆ–åœ¨çº¿æŸ¥çœ‹
open https://dreampuf.github.io/GraphvizOnline/
# ç„¶åç²˜è´´ openeye-callgraph.dot å†…å®¹
```

---

## ğŸ“ å­¦ä¹ ä»·å€¼

æœ¬åˆ†æå±•ç¤ºäº†ï¼š
1. âœ… **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: HarmonyOS åº”ç”¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
2. âœ… **å‡½æ•°é—´æ•°æ®æµ**: è·¨æ–¹æ³•çš„æ•°æ®ä¼ é€’è·¯å¾„
3. âœ… **è°ƒç”¨å›¾æ„å»º**: CHA ç®—æ³•çš„å®é™…åº”ç”¨
4. âœ… **é™æ€åˆ†æ**: IFDS æ¡†æ¶æ£€æµ‹æ½œåœ¨é—®é¢˜
5. âœ… **å¤§å‹é¡¹ç›®åˆ†æ**: 74 æ–‡ä»¶ã€500+ æ–¹æ³•çš„å¤æ‚é¡¹ç›®

---

## ğŸ“Š ä¸ TodoList é¡¹ç›®å¯¹æ¯”

| ç»´åº¦ | HarmoneyOpenEye | TodoList |
|------|----------------|----------|
| æ–‡ä»¶æ•° | 74 | 9 |
| æ–¹æ³•æ•° | 505 | 100 |
| ç”Ÿå‘½å‘¨æœŸæ–¹æ³• | 33 | 9 |
| è°ƒç”¨å›¾èŠ‚ç‚¹ | 529 | 189 |
| è°ƒç”¨å›¾è¾¹ | 409 | 103 |
| æ•°æ®æµè·¯å¾„ | 44 | 9 |
| æœªå®šä¹‰é—®é¢˜ | 3 | 0 |
| é¡¹ç›®è§„æ¨¡ | ğŸ”¥ å¤§å‹ç”Ÿäº§çº§ | ğŸŒŸ å°å‹ç¤ºä¾‹ |

---

**åˆ†æå®Œæˆ**: 2025å¹´11æœˆ17æ—¥  
**åˆ†æå·¥å…·**: ArkAnalyzer v1.0.8  
**ä»£ç è´¨é‡**: â­â­â­â­ ä¼˜ç§€ï¼ˆä»…3ä¸ªä¸­ç­‰é—®é¢˜ï¼‰  
**æ¨èæŒ‡æ•°**: â­â­â­â­â­ å¼ºçƒˆæ¨èå­¦ä¹ 
