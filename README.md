# HarmoneyOpenEye é¡¹ç›®é™æ€åˆ†æ

æœ¬ç›®å½•åŒ…å«å¯¹ **HarmoneyOpenEye** é¡¹ç›®ï¼ˆä»¿å¼€çœ¼è§†é¢‘ HarmonyOS åº”ç”¨ï¼‰çš„å®Œæ•´é™æ€åˆ†æã€‚

---

## ğŸ“‚ æ–‡ä»¶è¯´æ˜

### åˆ†æè„šæœ¬
- ğŸ“„ **analyzeOpenEyeProject.ts** - UndefinedVariable ç©ºæŒ‡é’ˆåˆ†æ
- ğŸ“„ **analyzeOpenEyeLifecycle.ts** - ç”Ÿå‘½å‘¨æœŸä¸å‡½æ•°é—´æ•°æ®æµåˆ†æ

### é…ç½®æ–‡ä»¶
- âš™ï¸ **config.json** - é¡¹ç›®é…ç½®
- âš™ï¸ **tsconfig.json** - TypeScript é…ç½®
- âš™ï¸ **package.json** - ä¾èµ–ç®¡ç†

### åˆ†æç»“æœ
- ğŸ“Š **åˆ†æç»“æœ.md** - UndefinedVariable åˆ†æç»“æœ
- ğŸ“Š **ç”Ÿå‘½å‘¨æœŸåˆ†æç»“æœ.md** - ç”Ÿå‘½å‘¨æœŸä¸æ•°æ®æµåˆ†æç»“æœï¼ˆæ¨èé˜…è¯»ï¼‰
- ğŸ—ºï¸ **output/openeye-callgraph.dot** - è°ƒç”¨å›¾å¯è§†åŒ–æ–‡ä»¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
cd openeye-analysis
npm install
```

### 2. è¿è¡Œåˆ†æ

#### æ–¹å¼ä¸€ï¼šUndefinedVariable åˆ†æ
```bash
ts-node analyzeOpenEyeProject.ts
```

#### æ–¹å¼äºŒï¼šç”Ÿå‘½å‘¨æœŸä¸æ•°æ®æµåˆ†æï¼ˆæ¨èï¼‰
```bash
ts-node analyzeOpenEyeLifecycle.ts
```

---

## ğŸ“Š åˆ†æç»“æœæ¦‚è§ˆ

### åˆ†æä¸€ï¼šUndefinedVariable ç©ºæŒ‡é’ˆæ£€æµ‹

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ‰«ææ–‡ä»¶ | 74 |
| åˆ†æç±» | 393 |
| åˆ†ææ–¹æ³• | 471 |
| æ£€æµ‹é—®é¢˜ | 0 |
| ä»£ç è¯„çº§ | â­â­â­â­â­ |

**ç»“è®º**: æœªå‘ç°ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œä»£ç è´¨é‡ä¼˜ç§€ï¼

---

### åˆ†æäºŒï¼šç”Ÿå‘½å‘¨æœŸä¸æ•°æ®æµåˆ†æ â­ æ¨è

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| æ€»æ–‡ä»¶æ•° | 74 | é¡¹ç›®æºæ–‡ä»¶ |
| æ€»æ–¹æ³•æ•° | 505 | æ‰€æœ‰æ–¹æ³• |
| **ç”Ÿå‘½å‘¨æœŸæ–¹æ³•** | **33** | 6ä¸ªAbility + 27ä¸ªComponent |
| **è°ƒç”¨å›¾èŠ‚ç‚¹** | **529** | æ–¹æ³•èŠ‚ç‚¹ |
| **è°ƒç”¨å›¾è¾¹** | **409** | è°ƒç”¨å…³ç³» |
| **æ•°æ®æµè·¯å¾„** | **44** | å‡½æ•°é—´æ•°æ®æµ |
| **æœªå®šä¹‰é—®é¢˜** | **3** | ä¸­ç­‰ä¸¥é‡ç¨‹åº¦ |

**äº®ç‚¹**:
- âœ… å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸè¯†åˆ«ï¼ˆ33ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼‰
- âœ… å¤§è§„æ¨¡è°ƒç”¨å›¾ï¼ˆ529èŠ‚ç‚¹ï¼Œ409è¾¹ï¼‰
- âœ… å‡½æ•°é—´æ•°æ®æµè¿½è¸ªï¼ˆ44æ¡è·¯å¾„ï¼‰
- âœ… IFDS æ¡†æ¶ç©ºæŒ‡é’ˆæ£€æµ‹ï¼ˆå‘ç°3ä¸ªæ½œåœ¨é—®é¢˜ï¼‰

---

## ğŸ¯ å‘ç°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

### Ability ç”Ÿå‘½å‘¨æœŸï¼ˆ1ä¸ªç±»ï¼Œ6ä¸ªæ–¹æ³•ï¼‰
```
EntryAbility:
  âœ“ onCreate()
  âœ“ onWindowStageCreate()
  âœ“ onForeground()
  âœ“ onBackground()
  âœ“ onWindowStageDestroy()
  âœ“ onDestroy()
```

### Component ç”Ÿå‘½å‘¨æœŸï¼ˆ21ä¸ªç±»ï¼Œ27ä¸ªæ–¹æ³•ï¼‰

**ä¸»è¦é¡µé¢** (11ä¸ª):
- MainPage (4ä¸ªæ–¹æ³•: aboutToAppear, aboutToDisappear, onPageShow, onPageHide)
- SplashPage, HomePage, FindPage, TopicPage, RankPage, MinePage
- CategoryPage, CategoryDetailPage, DetailPage, TopicDetailPage

**UIç»„ä»¶** (5ä¸ª):
- VideoBottomComponent, CommonSkeleton, CommonDialog
- CommonTopBar, CustomTabLayout, LoadingDialog

**å…¶ä»–** (5ä¸ª):
- HotPage, CoordinatePage, ContainerPage, FocusPage

---

## ğŸ”„ å…³é”®æ•°æ®æµå‘ç°

### 1. åº”ç”¨å¯åŠ¨æµç¨‹
```
EntryAbility.onCreate
  â†“
EntryAbility.onWindowStageCreate
  â†“ windowStage.loadContent()
SplashPage.aboutToAppear
  â†“ setTimeout()
MainPage.aboutToAppear
  â†“ emitter.on()
```

### 2. é¡µé¢åˆå§‹åŒ–æ¨¡å¼
```
aboutToAppear() â†’ loadData() â†’ updateUI()
```
å‘ç°äº 20+ é¡µé¢

### 3. æ¸…ç†æ¨¡å¼
```
aboutToDisappear() â†’ cleanup() â†’ removeListeners()
```
å‘ç°äº MainPage, MinePage, CustomTabLayout

### 4. è·¯ç”±æ¨¡å¼
```
aboutToAppear() â†’ router.getParams() â†’ loadDataWithParams()
```
å‘ç°äº CategoryDetailPage, DetailPage, TopicDetailPage

---

## âš ï¸ å‘ç°çš„é—®é¢˜

### æœªå®šä¹‰å˜é‡é—®é¢˜ï¼ˆ3ä¸ªï¼Œä¸­ç­‰ä¸¥é‡ç¨‹åº¦ï¼‰

1. **EntryAbility.onWindowStageCreate** (è¡Œ24)
   - é—®é¢˜: `windowClass = null`
   - ä¿®å¤: æ·»åŠ ç©ºå€¼æ£€æŸ¥

2. **MainPage.aboutToDisappear** (è¡Œ44)
   - é—®é¢˜: `this.loadedEventId` å¯èƒ½æœªå®šä¹‰
   - ä¿®å¤: åœ¨ä½¿ç”¨å‰æ£€æŸ¥æ˜¯å¦å­˜åœ¨

3. **MinePage.aboutToDisappear** (è¡Œ24)
   - é—®é¢˜: å±æ€§è®¿é—®å¯èƒ½ä¸º undefined
   - ä¿®å¤: æ·»åŠ å±æ€§åˆå§‹åŒ–æ£€æŸ¥

---

## ğŸ“ˆ è°ƒç”¨å›¾åˆ†æ

### è§„æ¨¡
- **èŠ‚ç‚¹æ•°**: 529 ä¸ªæ–¹æ³•
- **è¾¹æ•°**: 409 æ¡è°ƒç”¨å…³ç³»
- **ç®—æ³•**: CHA (Class Hierarchy Analysis)

### å¯è§†åŒ–
```bash
# ç”Ÿæˆ PNG å›¾ç‰‡
dot -Tpng ./output/openeye-callgraph.dot -o callgraph.png

# æˆ–åœ¨çº¿æŸ¥çœ‹
open https://dreampuf.github.io/GraphvizOnline/
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åˆ†ææ¡†æ¶
- **ArkAnalyzer**: é™æ€åˆ†ææ¡†æ¶
- **Scene**: ä»£ç æ¨¡å‹æŠ½è±¡
- **CFG**: æ§åˆ¶æµå›¾
- **CallGraph**: è°ƒç”¨å›¾ï¼ˆCHAç®—æ³•ï¼‰
- **IFDS**: å‡½æ•°é—´æ•°æ®æµåˆ†ææ¡†æ¶
- **UndefinedVariable**: ç©ºæŒ‡é’ˆæ£€æµ‹å™¨

### ç®—æ³•
- **CHA**: Class Hierarchy Analysisï¼ˆç±»å±‚æ¬¡åˆ†æï¼‰
- **IFDS**: Interprocedural Finite Distributive Subsetï¼ˆå‡½æ•°é—´æœ‰é™åˆ†é…å­é›†ï¼‰
- **DummyMain**: è™šæ‹Ÿå…¥å£ç‚¹ç”Ÿæˆ

---

## ğŸ’¡ åˆ†æä»·å€¼

### 1. æ¶æ„ç†è§£
- æ¸…æ™°å±•ç¤º 33 ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„åˆ†å¸ƒ
- 529 ä¸ªæ–¹æ³•èŠ‚ç‚¹çš„è°ƒç”¨å…³ç³»
- 44 æ¡å‡½æ•°é—´æ•°æ®æµè·¯å¾„

### 2. ä»£ç è´¨é‡
- ä»…å‘ç° 3 ä¸ªä¸­ç­‰é—®é¢˜
- ä»£ç æ•´ä½“è´¨é‡ä¼˜ç§€
- ç”Ÿå‘½å‘¨æœŸä½¿ç”¨è§„èŒƒ

### 3. ä¼˜åŒ–å»ºè®®
- æ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼ˆ3å¤„ï¼‰
- å®Œå–„æ¸…ç†é€»è¾‘ï¼ˆéƒ¨åˆ†ç»„ä»¶ç¼ºå°‘ aboutToDisappearï¼‰
- å®šæ—¶å™¨æ¸…ç†ï¼ˆSplashPageï¼‰

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

### æ¨èé˜…è¯»é¡ºåº

1. **å…¥é—¨**: å…ˆçœ‹æœ¬ README
2. **æ¦‚è§ˆ**: é˜…è¯» [åˆ†æç»“æœ.md](./åˆ†æç»“æœ.md) - UndefinedVariable åˆ†æ
3. **æ·±å…¥**: é˜…è¯» [ç”Ÿå‘½å‘¨æœŸåˆ†æç»“æœ.md](./ç”Ÿå‘½å‘¨æœŸåˆ†æç»“æœ.md) â­ é‡ç‚¹æ¨è
4. **å¯è§†åŒ–**: æŸ¥çœ‹ `output/openeye-callgraph.dot` è°ƒç”¨å›¾

---

## ğŸ“ å­¦ä¹ ä»·å€¼

æœ¬åˆ†æå±•ç¤ºäº†ï¼š
1. âœ… **å¤§å‹é¡¹ç›®åˆ†æ**: 74 æ–‡ä»¶ã€500+ æ–¹æ³•
2. âœ… **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: HarmonyOS å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
3. âœ… **å‡½æ•°é—´æ•°æ®æµ**: IFDS æ¡†æ¶å®é™…åº”ç”¨
4. âœ… **è°ƒç”¨å›¾æ„å»º**: CHA ç®—æ³•åœ¨å®è·µä¸­çš„åº”ç”¨
5. âœ… **é™æ€åˆ†æ**: è‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æµ‹

---

## ğŸ“Š é¡¹ç›®å¯¹æ¯”

| é¡¹ç›® | æ–‡ä»¶ | æ–¹æ³• | ç”Ÿå‘½å‘¨æœŸ | è°ƒç”¨å›¾èŠ‚ç‚¹ | é—®é¢˜ | è§„æ¨¡ |
|------|------|------|----------|-----------|------|------|
| **HarmoneyOpenEye** | 74 | 505 | 33 | 529 | 3 | ğŸ”¥ å¤§å‹ |
| TodoList | 9 | 100 | 9 | 189 | 0 | ğŸŒŸ å°å‹ |

HarmoneyOpenEye æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§å¤§å‹é¡¹ç›®**ï¼Œä»£ç è´¨é‡ä¼˜ç§€ï¼

---

## ğŸ” ä½¿ç”¨åœºæ™¯

### 1. å¼€å‘é˜¶æ®µ
- ç†è§£é¡¹ç›®ç”Ÿå‘½å‘¨æœŸè®¾è®¡
- å‘ç°æ½œåœ¨çš„ç©ºæŒ‡é’ˆé—®é¢˜
- ä¼˜åŒ–æ•°æ®æµè·¯å¾„

### 2. ä»£ç å®¡æŸ¥
- æ£€æŸ¥ç”Ÿå‘½å‘¨æœŸä½¿ç”¨æ˜¯å¦è§„èŒƒ
- éªŒè¯æ¸…ç†é€»è¾‘æ˜¯å¦å®Œæ•´
- è¯„ä¼°ä»£ç è´¨é‡

### 3. é‡æ„ä¼˜åŒ–
- è¯†åˆ«å†—ä½™çš„æ–¹æ³•è°ƒç”¨
- ä¼˜åŒ–æ•°æ®æµè·¯å¾„
- æå–å…¬å…±ç”Ÿå‘½å‘¨æœŸé€»è¾‘

### 4. å­¦ä¹ ç ”ç©¶
- å­¦ä¹  HarmonyOS ç”Ÿå‘½å‘¨æœŸ
- ç†è§£é™æ€åˆ†ææŠ€æœ¯
- ç ”ç©¶è°ƒç”¨å›¾å’Œæ•°æ®æµ

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1: "Cannot find module"
```bash
npm install
```

### é—®é¢˜2: åˆ†ææ—¶é—´è¿‡é•¿
- æ­£å¸¸ç°è±¡ï¼ˆ74ä¸ªæ–‡ä»¶éœ€è¦å‡ åç§’ï¼‰
- å¯ä»¥å‡å°‘åˆ†æèŒƒå›´

### é—®é¢˜3: TypeScript ç¼–è¯‘é”™è¯¯
- å·²é…ç½® `transpileOnly: true`
- åº”è¯¥ä¸ä¼šå‡ºç°

---

## ğŸ“ ç›¸å…³é“¾æ¥

- **é¡¹ç›®åœ°å€**: https://github.com/WinWang/HarmoneyOpenEye
- **ArkAnalyzer**: é™æ€åˆ†ææ¡†æ¶æ–‡æ¡£
- **TodoList åˆ†æ**: ../todolist-analysis

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´11æœˆ17æ—¥  
**åˆ†æå·¥å…·**: ArkAnalyzer v1.0.8  
**é¡¹ç›®**: HarmoneyOpenEye (ä»¿å¼€çœ¼è§†é¢‘)  
**ä»£ç è´¨é‡**: â­â­â­â­ ä¼˜ç§€
